(function () {
    'use strict';

    const STORAGE_KEY = 'tw_script_manager_state_v2';
    const savedState = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

    const categories = {
        ataque: '‚öîÔ∏è Ataque',
        defesa: 'üõ°Ô∏è Defesa',
        organizacao: 'üß© Organiza√ß√£o'
    };

    const scripts = [
        {
            name: 'Conversor Defesa POP',
            key: 'conversor',
            icon: 'üõ†Ô∏è',
            tooltip: 'Converter tropas em c√≥digo de defesa BB',
            url: 'https://raw.githubusercontent.com/eleicaotw/TWSetupPro/refs/heads/main/conversor-forum-code-bb-defesa.js',
            categoria: 'organizacao'
        },
        {
            name: 'MP OP Auto',
            key: 'mpop',
            icon: 'üì®',
            tooltip: 'Automatizar envio de MPs em OPs',
            url: 'https://raw.githubusercontent.com/eleicaotw/TWSetupPro/refs/heads/main/mp-op-auto.js',
            categoria: 'organizacao'
        }
    ];

    const style = document.createElement('style');
    style.textContent = `
        #tw_script_manager_painel {
            position: fixed;
            top: 120px;
            left: 20px;
            z-index: 9999;
            background: #f4e4bc;
            padding: 10px;
            border: 2px solid #c4a300;
            font-family: Verdana;
            border-radius: 12px;
            box-shadow: 2px 2px 8px #0006;
